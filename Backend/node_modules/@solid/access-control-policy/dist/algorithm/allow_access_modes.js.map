{"version":3,"file":"allow_access_modes.js","sourceRoot":"","sources":["../../src/algorithm/allow_access_modes.ts"],"names":[],"mappings":";;;AAGA,iDAA6C;AAE7C;;;;;;;;;;GAUG;AACH,SAAgB,gBAAgB,CAC9B,QAAmB,EACnB,OAAiB;IAEjB,MAAM,YAAY,GAAqB,IAAI,GAAG,EAAE,CAAC;IACjD,MAAM,WAAW,GAAqB,IAAI,GAAG,EAAE,CAAC;IAEhD,4BAA4B;IAC5B,KAAK,MAAM,MAAM,IAAI,QAAQ,EAAE;QAC7B,4DAA4D;QAC5D,IAAI,IAAA,0BAAW,EAAC,MAAM,EAAE,OAAO,CAAC,EAAE;YAChC,6CAA6C;YAC7C,MAAM,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,UAAU,EAAE,EAAE,CAAC,YAAY,CAAC,GAAG,CAAC,UAAU,CAAC,CAAC,CAAC;YACnE,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC,UAAU,EAAE,EAAE,CAAC,WAAW,CAAC,GAAG,CAAC,UAAU,CAAC,CAAC,CAAC;SAClE;KACF;IAED,iDAAiD;IACjD,KAAK,MAAM,UAAU,IAAI,WAAW,EAAE;QACpC,YAAY,CAAC,MAAM,CAAC,UAAU,CAAC,CAAC;KACjC;IAED,qDAAqD;IACrD,OAAO,YAAY,CAAC;AACtB,CAAC;AAxBD,4CAwBC","sourcesContent":["import type { IAccessMode } from \"../type/i_access_mode\";\nimport type { IContext } from \"../type/i_context\";\nimport type { IPolicy } from \"../type/i_policy\";\nimport { applyPolicy } from \"./apply_policy\";\n\n/**\n * # The allow access modes algorithm\n *\n * An access mode is allowed if:\n * - A policy that applies allows it; and\n * - No policy that applies deny it.\n *\n * @param policies The policies to evaluate\n * @param context The context in which the policies are evaluated\n * @returns A set of allowed access modes\n */\nexport function allowAccessModes(\n  policies: IPolicy[],\n  context: IContext\n): Set<IAccessMode> {\n  const allowedModes: Set<IAccessMode> = new Set();\n  const deniedModes: Set<IAccessMode> = new Set();\n\n  // Loop through all policies\n  for (const policy of policies) {\n    // Satisfied policies contribute to allowed and denied modes\n    if (applyPolicy(policy, context)) {\n      // Add modes to the set of allowed and denied\n      policy.allow.forEach((accessMode) => allowedModes.add(accessMode));\n      policy.deny.forEach((accessMode) => deniedModes.add(accessMode));\n    }\n  }\n\n  // Remove the denied modes from the allowed modes\n  for (const deniedMode of deniedModes) {\n    allowedModes.delete(deniedMode);\n  }\n\n  // Return filtering out eventual illegal access modes\n  return allowedModes;\n}\n"]}