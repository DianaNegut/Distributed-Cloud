{"version":3,"file":"SolidTokenVerifier.js","sourceRoot":"","sources":["../../src/class/SolidTokenVerifier.ts"],"names":[],"mappings":";;;AAAA,kEAAqE;AACrE,gFAA6E;AAE7E,iDAA8C;AAC9C,2DAAwD;AACxD,2DAAwD;AAExD,MAAa,kBAAkB;IACrB,YAAY,CAAe;IAE3B,iBAAiB,CAAoB;IAErC,iBAAiB,CAAoB;IAE7C,YACE,YAA2B,EAC3B,iBAAqC,EACrC,iBAAqC;QAErC,IAAI,CAAC,YAAY,GAAG,YAAY,IAAI,IAAI,2BAAY,EAAE,CAAC;QACvD,IAAI,CAAC,iBAAiB,GAAG,iBAAiB,IAAI,IAAI,qCAAiB,EAAE,CAAC;QACtE,IAAI,CAAC,iBAAiB,GAAG,iBAAiB,IAAI,IAAI,qCAAiB,EAAE,CAAC;IACxE,CAAC;IAEM,KAAK,CAAC,MAAM,CACjB,mBAA2B,EAC3B,IAAkB;QAElB,IAAI,QAAQ,CAAC;QACb,IAAI,IAAA,qCAAoB,EAAC,IAAI,CAAC,EAAE;YAC9B,QAAQ,GAAG;gBACT,MAAM,EAAE,IAAI,CAAC,MAAM;gBACnB,MAAM,EAAE,IAAI,CAAC,MAAM;gBACnB,GAAG,EAAE,IAAI,CAAC,GAAG;gBACb,cAAc,EAAE,CACd,IAAI,CAAC,cAAc,IAAI,IAAI,CAAC,YAAY,CAAC,cAAc,CACxD,CAAC,IAAI,CAAC,IAAI,CAAC,YAAY,CAAC;aAC1B,CAAC;SACH;QACD,OAAO,IAAA,+CAAsB,EAC3B;YACE,MAAM,EAAE,mBAAmB;YAC3B,OAAO,EAAE,IAAI,CAAC,iBAAiB,CAAC,UAAU,CAAC,IAAI,CAAC,IAAI,CAAC,iBAAiB,CAAC;YACvE,MAAM,EAAE,IAAI,CAAC,iBAAiB,CAAC,SAAS,CAAC,IAAI,CAAC,IAAI,CAAC,iBAAiB,CAAC;SACtE,EACD,QAAQ,CACT,CAAC;IACJ,CAAC;CACF;AAzCD,gDAyCC","sourcesContent":["import { isNotNullOrUndefined } from \"ts-guards/dist/primitive-type\";\nimport { verifySolidAccessToken } from \"../algorithm/verifySolidAccessToken\";\nimport type { SolidAccessTokenPayload, DPoPOptions } from \"../type\";\nimport { DPoPJTICache } from \"./DPoPJTICache\";\nimport { IssuerKeySetCache } from \"./IssuerKeySetCache\";\nimport { WebIDIssuersCache } from \"./WebIDIssuersCache\";\n\nexport class SolidTokenVerifier {\n  private dpopJtiCache: DPoPJTICache;\n\n  private issuerKeySetCache: IssuerKeySetCache;\n\n  private webIDIssuersCache: WebIDIssuersCache;\n\n  public constructor(\n    dpopJtiCache?: DPoPJTICache,\n    issuerKeySetCache?: IssuerKeySetCache,\n    webIDIssuersCache?: WebIDIssuersCache,\n  ) {\n    this.dpopJtiCache = dpopJtiCache ?? new DPoPJTICache();\n    this.issuerKeySetCache = issuerKeySetCache ?? new IssuerKeySetCache();\n    this.webIDIssuersCache = webIDIssuersCache ?? new WebIDIssuersCache();\n  }\n\n  public async verify(\n    authorizationHeader: string,\n    dpop?: DPoPOptions,\n  ): Promise<SolidAccessTokenPayload> {\n    let dpopArgs;\n    if (isNotNullOrUndefined(dpop)) {\n      dpopArgs = {\n        header: dpop.header,\n        method: dpop.method,\n        url: dpop.url,\n        isDuplicateJTI: (\n          dpop.isDuplicateJTI ?? this.dpopJtiCache.isDuplicateJTI\n        ).bind(this.dpopJtiCache),\n      };\n    }\n    return verifySolidAccessToken(\n      {\n        header: authorizationHeader,\n        issuers: this.webIDIssuersCache.getIssuers.bind(this.webIDIssuersCache),\n        keySet: this.issuerKeySetCache.getKeySet.bind(this.issuerKeySetCache),\n      },\n      dpopArgs,\n    );\n  }\n}\n"]}