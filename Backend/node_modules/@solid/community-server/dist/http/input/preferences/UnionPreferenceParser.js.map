{"version":3,"file":"UnionPreferenceParser.js","sourceRoot":"","sources":["../../../../src/http/input/preferences/UnionPreferenceParser.ts"],"names":[],"mappings":";;;AAAA,kFAA+E;AAC/E,sEAAmE;AAInE;;;GAGG;AACH,MAAa,qBAAsB,SAAQ,2BAA8B;IACvE,YAAmB,OAA2B;QAC5C,KAAK,CAAC,OAAO,EAAE,KAAK,EAAE,KAAK,CAAC,CAAC;IAC/B,CAAC;IAES,KAAK,CAAC,OAAO,CAAC,OAAoC;QAC1D,MAAM,UAAU,GAAG,OAAO,CAAC,MAAM,CAAC,CAAC,MAAM,EAAW,EAAE,CAAC,OAAO,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC,CAAC,MAAM,CAAC;QACrF,IAAI,UAAU,GAAG,CAAC,EAAE,CAAC;YACnB,MAAM,IAAI,yCAAmB,CAAC,+DAA+D,CAAC,CAAC;QACjG,CAAC;QAED,MAAM,WAAW,GAA8B,EAAE,CAAC;QAClD,KAAK,MAAM,MAAM,IAAI,OAAO,EAAE,CAAC;YAC7B,KAAK,MAAM,GAAG,IAAI,MAAM,CAAC,IAAI,CAAC,MAAM,CAAwC,EAAE,CAAC;gBAC7E,IAAI,GAAG,KAAK,OAAO,EAAE,CAAC;oBACpB,WAAW,CAAC,GAAG,CAAC,GAAG,MAAM,CAAC,GAAG,CAAC,CAAC;gBACjC,CAAC;qBAAM,CAAC;oBACN,WAAW,CAAC,GAAG,CAAC,GAAG,EAAE,GAAG,WAAW,CAAC,GAAG,CAAC,EAAE,GAAG,MAAM,CAAC,GAAG,CAAC,EAAE,CAAC;gBAC7D,CAAC;YACH,CAAC;QACH,CAAC;QACD,OAAO,WAAW,CAAC;IACrB,CAAC;CACF;AAvBD,sDAuBC","sourcesContent":["import { InternalServerError } from '../../../util/errors/InternalServerError';\nimport { UnionHandler } from '../../../util/handlers/UnionHandler';\nimport type { RepresentationPreferences } from '../../representation/RepresentationPreferences';\nimport type { PreferenceParser } from './PreferenceParser';\n\n/**\n * Combines the results of multiple {@link PreferenceParser}s.\n * Will throw an error if multiple parsers return a range as these can't logically be combined.\n */\nexport class UnionPreferenceParser extends UnionHandler<PreferenceParser> {\n  public constructor(parsers: PreferenceParser[]) {\n    super(parsers, false, false);\n  }\n\n  protected async combine(results: RepresentationPreferences[]): Promise<RepresentationPreferences> {\n    const rangeCount = results.filter((result): boolean => Boolean(result.range)).length;\n    if (rangeCount > 1) {\n      throw new InternalServerError('Found multiple range values. This implies a misconfiguration.');\n    }\n\n    const preferences: RepresentationPreferences = {};\n    for (const result of results) {\n      for (const key of Object.keys(result) as (keyof RepresentationPreferences)[]) {\n        if (key === 'range') {\n          preferences[key] = result[key];\n        } else {\n          preferences[key] = { ...preferences[key], ...result[key] };\n        }\n      }\n    }\n    return preferences;\n  }\n}\n"]}