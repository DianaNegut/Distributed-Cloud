{"version":3,"file":"HeadOperationHandler.js","sourceRoot":"","sources":["../../../src/http/ldp/HeadOperationHandler.ts"],"names":[],"mappings":";;;AAEA,uFAAoF;AACpF,0DAA+D;AAC/D,oFAAiF;AAGjF,yDAAsD;AAEtD;;;GAGG;AACH,MAAa,oBAAqB,SAAQ,mCAAgB;IACvC,KAAK,CAAgB;IACrB,WAAW,CAAc;IAE1C,YAAmB,KAAoB,EAAE,WAAwB;QAC/D,KAAK,EAAE,CAAC;QACR,IAAI,CAAC,KAAK,GAAG,KAAK,CAAC;QACnB,IAAI,CAAC,WAAW,GAAG,WAAW,CAAC;IACjC,CAAC;IAEM,KAAK,CAAC,SAAS,CAAC,EAAE,SAAS,EAAyB;QACzD,IAAI,SAAS,CAAC,MAAM,KAAK,MAAM,EAAE,CAAC;YAChC,MAAM,IAAI,iDAAuB,CAAC,4CAA4C,CAAC,CAAC;QAClF,CAAC;IACH,CAAC;IAEM,KAAK,CAAC,MAAM,CAAC,EAAE,SAAS,EAAyB;QACtD,MAAM,IAAI,GAAG,MAAM,IAAI,CAAC,KAAK,CAAC,iBAAiB,CAAC,SAAS,CAAC,MAAM,EAAE,SAAS,CAAC,WAAW,EAAE,SAAS,CAAC,UAAU,CAAC,CAAC;QAE/G,0GAA0G;QAC1G,iHAAiH;QACjH,IAAA,mCAAoB,EAAC,IAAI,EAAE,IAAI,CAAC,WAAW,EAAE,SAAS,CAAC,UAAU,CAAC,CAAC;QAEnE,+CAA+C;QAC/C,IAAI,CAAC,IAAI,CAAC,OAAO,EAAE,CAAC;QAEpB,OAAO,IAAI,6CAAqB,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;IAClD,CAAC;CACF;AA5BD,oDA4BC","sourcesContent":["import type { ETagHandler } from '../../storage/conditions/ETagHandler';\nimport type { ResourceStore } from '../../storage/ResourceStore';\nimport { NotImplementedHttpError } from '../../util/errors/NotImplementedHttpError';\nimport { assertReadConditions } from '../../util/ResourceUtil';\nimport { OkResponseDescription } from '../output/response/OkResponseDescription';\nimport type { ResponseDescription } from '../output/response/ResponseDescription';\nimport type { OperationHandlerInput } from './OperationHandler';\nimport { OperationHandler } from './OperationHandler';\n\n/**\n * Handles HEAD {@link Operation}s.\n * Calls the getRepresentation function from a {@link ResourceStore}.\n */\nexport class HeadOperationHandler extends OperationHandler {\n  private readonly store: ResourceStore;\n  private readonly eTagHandler: ETagHandler;\n\n  public constructor(store: ResourceStore, eTagHandler: ETagHandler) {\n    super();\n    this.store = store;\n    this.eTagHandler = eTagHandler;\n  }\n\n  public async canHandle({ operation }: OperationHandlerInput): Promise<void> {\n    if (operation.method !== 'HEAD') {\n      throw new NotImplementedHttpError('This handler only supports HEAD operations');\n    }\n  }\n\n  public async handle({ operation }: OperationHandlerInput): Promise<ResponseDescription> {\n    const body = await this.store.getRepresentation(operation.target, operation.preferences, operation.conditions);\n\n    // Check whether the cached representation is still valid or it is necessary to send a new representation.\n    // Generally it doesn't make much sense to use condition headers with a HEAD request, but it should be supported.\n    assertReadConditions(body, this.eTagHandler, operation.conditions);\n\n    // Close the Readable as we will not return it.\n    body.data.destroy();\n\n    return new OkResponseDescription(body.metadata);\n  }\n}\n"]}