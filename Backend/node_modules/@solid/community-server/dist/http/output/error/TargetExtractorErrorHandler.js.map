{"version":3,"file":"TargetExtractorErrorHandler.js","sourceRoot":"","sources":["../../../../src/http/output/error/TargetExtractorErrorHandler.ts"],"names":[],"mappings":";;;AAAA,2BAAiC;AACjC,sDAAwD;AACxD,8DAAoE;AACpE,6DAAyD;AAIzD,iDAA8C;AAE9C;;GAEG;AACH,MAAa,2BAA4B,SAAQ,2BAAY;IACxC,MAAM,GAAG,IAAA,sBAAY,EAAC,IAAI,CAAC,CAAC;IAE5B,YAAY,CAAe;IAC3B,eAAe,CAAkB;IAEpD,YAAmB,YAA0B,EAAE,eAAgC;QAC7E,KAAK,EAAE,CAAC;QACR,IAAI,CAAC,YAAY,GAAG,YAAY,CAAC;QACjC,IAAI,CAAC,eAAe,GAAG,eAAe,CAAC;IACzC,CAAC;IAEM,KAAK,CAAC,SAAS,CAAC,KAAuB;QAC5C,OAAO,IAAI,CAAC,YAAY,CAAC,SAAS,CAAC,KAAK,CAAC,CAAC;IAC5C,CAAC;IAEM,KAAK,CAAC,MAAM,CAAC,KAAuB;QACzC,IAAI,CAAC;YACH,MAAM,MAAM,GAAG,MAAM,IAAI,CAAC,eAAe,CAAC,UAAU,CAAC,KAAK,CAAC,CAAC;YAC5D,KAAK,CAAC,KAAK,CAAC,QAAQ,CAAC,GAAG,CAAC,0BAAW,CAAC,KAAK,CAAC,MAAM,EAAE,gBAAW,CAAC,SAAS,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC,CAAC;QACzF,CAAC;QAAC,OAAO,KAAK,EAAE,CAAC;YACf,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,+CAA+C,IAAA,8BAAkB,EAAC,KAAK,CAAC,EAAE,CAAC,CAAC;QAC/F,CAAC;QACD,OAAO,IAAI,CAAC,YAAY,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;IACzC,CAAC;CACF;AAzBD,kEAyBC","sourcesContent":["import { DataFactory } from 'n3';\nimport { getLoggerFor } from '../../../logging/LogUtil';\nimport { createErrorMessage } from '../../../util/errors/ErrorUtil';\nimport { SOLID_ERROR } from '../../../util/Vocabularies';\nimport type { TargetExtractor } from '../../input/identifier/TargetExtractor';\nimport type { ResponseDescription } from '../response/ResponseDescription';\nimport type { ErrorHandlerArgs } from './ErrorHandler';\nimport { ErrorHandler } from './ErrorHandler';\n\n/**\n * Adds metadata to an error to indicate the identifier of the originally targeted resource.\n */\nexport class TargetExtractorErrorHandler extends ErrorHandler {\n  protected readonly logger = getLoggerFor(this);\n\n  protected readonly errorHandler: ErrorHandler;\n  protected readonly targetExtractor: TargetExtractor;\n\n  public constructor(errorHandler: ErrorHandler, targetExtractor: TargetExtractor) {\n    super();\n    this.errorHandler = errorHandler;\n    this.targetExtractor = targetExtractor;\n  }\n\n  public async canHandle(input: ErrorHandlerArgs): Promise<void> {\n    return this.errorHandler.canHandle(input);\n  }\n\n  public async handle(input: ErrorHandlerArgs): Promise<ResponseDescription> {\n    try {\n      const target = await this.targetExtractor.handleSafe(input);\n      input.error.metadata.add(SOLID_ERROR.terms.target, DataFactory.namedNode(target.path));\n    } catch (error) {\n      this.logger.warn(`Unable to add identifier to error metadata: ${createErrorMessage(error)}`);\n    }\n    return this.errorHandler.handle(input);\n  }\n}\n"]}