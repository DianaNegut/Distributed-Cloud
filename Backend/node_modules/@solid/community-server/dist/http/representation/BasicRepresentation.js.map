{"version":3,"file":"BasicRepresentation.js","sourceRoot":"","sources":["../../../src/http/representation/BasicRepresentation.ts"],"names":[],"mappings":";;;AACA,0DAAyD;AAEzD,4DAAuD;AACvD,sDAA0D;AAG1D,qEAA4F;AAE5F;;;;;;;;;;;GAWG;AACH,MAAa,mBAAmB;IACd,IAAI,CAAoB;IACxB,QAAQ,CAAyB;IACjC,MAAM,CAAU;IAoEhC,YACE,IAAoC,EACpC,QAAgF,EAChF,YAAgD,EAChD,MAAgB;QAEhB,IAAI,OAAO,IAAI,KAAK,QAAQ,IAAI,KAAK,CAAC,OAAO,CAAC,IAAI,CAAC,EAAE,CAAC;YACpD,IAAI,GAAG,IAAA,8BAAiB,EAAC,IAAI,CAAC,CAAC;QACjC,CAAC;aAAM,IAAI,CAAC,IAAI,EAAE,CAAC;YACjB,IAAI,GAAG,IAAA,8BAAiB,EAAC,EAAE,CAAC,CAAC;QAC/B,CAAC;QACD,IAAI,CAAC,IAAI,GAAG,IAAA,2BAAW,EAAC,IAAI,CAAC,CAAC;QAE9B,IAAI,OAAO,YAAY,KAAK,SAAS,EAAE,CAAC;YACtC,MAAM,GAAG,YAAY,CAAC;YACtB,YAAY,GAAG,SAAS,CAAC;QAC3B,CAAC;QACD,IAAI,CAAC,IAAA,iDAAwB,EAAC,QAAQ,CAAC,IAAI,OAAO,YAAY,KAAK,QAAQ,EAAE,CAAC;YAC5E,2DAA2D;YAC3D,QAAQ,GAAG,IAAI,+CAAsB,CAAC,QAAkC,EAAE,YAAsB,CAAC,CAAC;QACpG,CAAC;QACD,IAAI,CAAC,QAAQ,GAAG,QAAQ,CAAC;QAEzB,IAAI,OAAO,MAAM,KAAK,SAAS,EAAE,CAAC;YAChC,MAAM,GAAG,QAAQ,CAAC,WAAW,KAAK,6BAAc,CAAC;QACnD,CAAC;QACD,IAAI,CAAC,MAAM,GAAG,MAAM,CAAC;IACvB,CAAC;IAED;;OAEG;IACH,IAAW,OAAO;QAChB,OAAO,CAAC,IAAI,CAAC,QAAQ,CAAC,WAAW,CAAC;IACpC,CAAC;CACF;AA1GD,kDA0GC","sourcesContent":["import type { Readable } from 'node:stream';\nimport { INTERNAL_QUADS } from '../../util/ContentTypes';\nimport type { Guarded } from '../../util/GuardedStream';\nimport { guardStream } from '../../util/GuardedStream';\nimport { guardedStreamFrom } from '../../util/StreamUtil';\nimport type { Representation } from './Representation';\nimport type { MetadataIdentifier, MetadataRecord } from './RepresentationMetadata';\nimport { isRepresentationMetadata, RepresentationMetadata } from './RepresentationMetadata';\n\n/**\n * Class with various constructors to facilitate creating a representation.\n *\n * A representation consists of 1) data, 2) metadata, and 3) a binary flag\n * to indicate whether the data is a binary stream or an object stream.\n *\n * 1. The data can be given as a stream, array, or string.\n * 2. The metadata can be specified as one or two parameters\n *    that will be passed to the {@link RepresentationMetadata} constructor.\n * 3. The binary field is optional, and if not specified,\n *    is determined from the content type inside the metadata.\n */\nexport class BasicRepresentation implements Representation {\n  public readonly data: Guarded<Readable>;\n  public readonly metadata: RepresentationMetadata;\n  public readonly binary: boolean;\n\n  /**\n   * An empty Representation\n   */\n  public constructor();\n\n  /**\n   * @param data - The representation data\n   * @param metadata - The representation metadata\n   * @param binary - Whether the representation is a binary or object stream\n   */\n  public constructor(\n    data: Guarded<Readable> | Readable | unknown[] | string,\n    metadata: RepresentationMetadata | MetadataRecord,\n    binary?: boolean,\n  );\n\n  /**\n   * @param data - The representation data\n   * @param metadata - The representation metadata\n   * @param contentType - The representation's content type\n   * @param binary - Whether the representation is a binary or object stream\n   */\n  public constructor(\n    data: Guarded<Readable> | Readable | unknown[] | string,\n    metadata: RepresentationMetadata | MetadataRecord,\n    contentType?: string,\n    binary?: boolean,\n  );\n\n  /**\n   * @param data - The representation data\n   * @param contentType - The representation's content type\n   * @param binary - Whether the representation is a binary or object stream\n   */\n  public constructor(\n    data: Guarded<Readable> | Readable | unknown[] | string,\n    contentType: string,\n    binary?: boolean,\n  );\n\n  /**\n   * @param data - The representation data\n   * @param identifier - The representation's identifier\n   * @param metadata - The representation metadata\n   * @param binary - Whether the representation is a binary or object stream\n   */\n  public constructor(\n    data: Guarded<Readable> | Readable | unknown[] | string,\n    identifier: MetadataIdentifier,\n    metadata?: MetadataRecord,\n    binary?: boolean,\n  );\n\n  /**\n   * @param data - The representation data\n   * @param identifier - The representation's identifier\n   * @param contentType - The representation's content type\n   * @param binary - Whether the representation is a binary or object stream\n   */\n  public constructor(\n    data: Guarded<Readable> | Readable | unknown[] | string,\n    identifier: MetadataIdentifier,\n    contentType?: string,\n    binary?: boolean,\n  );\n\n  public constructor(\n    data?: Readable | unknown[] | string,\n    metadata?: RepresentationMetadata | MetadataRecord | MetadataIdentifier | string,\n    metadataRest?: MetadataRecord | string | boolean,\n    binary?: boolean,\n  ) {\n    if (typeof data === 'string' || Array.isArray(data)) {\n      data = guardedStreamFrom(data);\n    } else if (!data) {\n      data = guardedStreamFrom([]);\n    }\n    this.data = guardStream(data);\n\n    if (typeof metadataRest === 'boolean') {\n      binary = metadataRest;\n      metadataRest = undefined;\n    }\n    if (!isRepresentationMetadata(metadata) || typeof metadataRest === 'string') {\n      // This combination will always match with a valid overload\n      metadata = new RepresentationMetadata(metadata as RepresentationMetadata, metadataRest as string);\n    }\n    this.metadata = metadata;\n\n    if (typeof binary !== 'boolean') {\n      binary = metadata.contentType !== INTERNAL_QUADS;\n    }\n    this.binary = binary;\n  }\n\n  /**\n   * Data should only be interpreted if there is a content type.\n   */\n  public get isEmpty(): boolean {\n    return !this.metadata.contentType;\n  }\n}\n"]}