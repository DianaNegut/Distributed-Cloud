{"version":3,"file":"AccountInitializer.js","sourceRoot":"","sources":["../../src/identity/AccountInitializer.ts"],"names":[],"mappings":";;;AAAA,qDAAkD;AAClD,gDAAkD;AAgClD;;GAEG;AACH,MAAa,kBAAmB,SAAQ,yBAAW;IAC9B,MAAM,GAAG,IAAA,sBAAY,EAAC,IAAI,CAAC,CAAC;IAE9B,YAAY,CAAe;IAC3B,aAAa,CAAgB;IAC7B,UAAU,CAAa;IAChC,KAAK,CAAqB;IAC1B,QAAQ,CAAqB;IACpB,IAAI,CAAqB;IAE1C,YAAmB,IAA4B;QAC7C,KAAK,EAAE,CAAC;QACR,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC,YAAY,CAAC;QACtC,IAAI,CAAC,aAAa,GAAG,IAAI,CAAC,aAAa,CAAC;QACxC,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC,UAAU,CAAC;QAElC,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC;QACxB,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC,QAAQ,CAAC;QAC9B,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC,IAAI,CAAC;IACxB,CAAC;IAEM,KAAK,CAAC,MAAM;QACjB,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,wBAAwB,IAAI,CAAC,KAAK,EAAE,CAAC,CAAC;QACvD,MAAM,SAAS,GAAG,MAAM,IAAI,CAAC,YAAY,CAAC,MAAM,EAAE,CAAC;QACnD,MAAM,EAAE,GAAG,MAAM,IAAI,CAAC,aAAa,CAAC,MAAM,CAAC,IAAI,CAAC,KAAM,EAAE,SAAS,EAAE,IAAI,CAAC,QAAS,CAAC,CAAC;QACnF,MAAM,IAAI,CAAC,aAAa,CAAC,mBAAmB,CAAC,EAAE,CAAC,CAAC;QACjD,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,gBAAgB,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC,aAAa,IAAI,CAAC,IAAI,EAAE,CAAC,CAAC,CAAC,aAAa,EAAE,CAAC,CAAC;QACzF,MAAM,IAAI,CAAC,UAAU,CAAC,UAAU,CAAC,EAAE,SAAS,EAAE,IAAI,EAAE,IAAI,CAAC,IAAI,EAAE,CAAC,CAAC;QAEjE,kFAAkF;QAClF,OAAO,IAAI,CAAC,KAAK,CAAC;QAClB,OAAO,IAAI,CAAC,QAAQ,CAAC;IACvB,CAAC;CACF;AAjCD,gDAiCC","sourcesContent":["import { Initializer } from '../init/Initializer';\nimport { getLoggerFor } from '../logging/LogUtil';\nimport type { AccountStore } from './interaction/account/util/AccountStore';\nimport type { PasswordStore } from './interaction/password/util/PasswordStore';\nimport type { PodCreator } from './interaction/pod/util/PodCreator';\n\nexport interface AccountInitializerArgs {\n  /**\n   * Creates the accounts.\n   */\n  accountStore: AccountStore;\n  /**\n   * Adds the login methods.\n   */\n  passwordStore: PasswordStore;\n  /**\n   * Creates the pods.\n   */\n  podCreator: PodCreator;\n  /**\n   * Email address for the account login.\n   */\n  email: string;\n  /**\n   * Password for the account login.\n   */\n  password: string;\n  /**\n   * Name to use for the pod. If undefined the pod will be made in the root of the server.\n   */\n  name?: string;\n}\n\n/**\n * Initializes an account with email/password login and a pod with the provided name.\n */\nexport class AccountInitializer extends Initializer {\n  protected readonly logger = getLoggerFor(this);\n\n  private readonly accountStore: AccountStore;\n  private readonly passwordStore: PasswordStore;\n  private readonly podCreator: PodCreator;\n  private email: string | undefined;\n  private password: string | undefined;\n  private readonly name: string | undefined;\n\n  public constructor(args: AccountInitializerArgs) {\n    super();\n    this.accountStore = args.accountStore;\n    this.passwordStore = args.passwordStore;\n    this.podCreator = args.podCreator;\n\n    this.email = args.email;\n    this.password = args.password;\n    this.name = args.name;\n  }\n\n  public async handle(): Promise<void> {\n    this.logger.info(`Creating account for ${this.email}`);\n    const accountId = await this.accountStore.create();\n    const id = await this.passwordStore.create(this.email!, accountId, this.password!);\n    await this.passwordStore.confirmVerification(id);\n    this.logger.info(`Creating pod ${this.name ? `with name ${this.name}` : 'at the root'}`);\n    await this.podCreator.handleSafe({ accountId, name: this.name });\n\n    // Not really necessary but don't want to keep passwords in memory if not required\n    delete this.email;\n    delete this.password;\n  }\n}\n"]}