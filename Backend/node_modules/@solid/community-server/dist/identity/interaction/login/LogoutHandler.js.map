{"version":3,"file":"LogoutHandler.js","sourceRoot":"","sources":["../../../../src/identity/interaction/login/LogoutHandler.ts"],"names":[],"mappings":";;;AAAA,gGAA6F;AAC7F,kFAA+E;AAE/E,6DAAwD;AAIxD,sEAAmE;AAEnE;;;GAGG;AACH,MAAa,aAAc,SAAQ,+CAAmC;IACnD,WAAW,CAAc;IAE1C,YAAmB,WAAwB;QACzC,KAAK,EAAE,CAAC;QACR,IAAI,CAAC,WAAW,GAAG,WAAW,CAAC;IACjC,CAAC;IAEM,KAAK,CAAC,MAAM,CAAC,KAAkC;QACpD,MAAM,EAAE,QAAQ,EAAE,SAAS,EAAE,MAAM,EAAE,GAAG,KAAK,CAAC;QAC9C,MAAM,MAAM,GAAG,QAAQ,CAAC,GAAG,CAAC,yBAAU,CAAC,KAAK,CAAC,aAAa,CAAC,EAAE,KAAK,CAAC;QACnE,IAAI,MAAM,EAAE,CAAC;YACX,sDAAsD;YACtD,MAAM,OAAO,GAAG,MAAM,IAAI,CAAC,WAAW,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC;YACnD,IAAI,OAAO,KAAK,SAAS,EAAE,CAAC;gBAC1B,MAAM,IAAI,yCAAmB,CAAC,iBAAiB,CAAC,CAAC;YACnD,CAAC;YAED,MAAM,IAAI,CAAC,WAAW,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC;YAEtC,yGAAyG;YACzG,MAAM,cAAc,GAAG,IAAI,+CAAsB,CAAC,MAAM,CAAC,CAAC;YAC1D,cAAc,CAAC,GAAG,CAAC,yBAAU,CAAC,KAAK,CAAC,aAAa,EAAE,MAAM,CAAC,CAAC;YAC3D,cAAc,CAAC,GAAG,CAAC,yBAAU,CAAC,KAAK,CAAC,uBAAuB,EAAE,IAAI,IAAI,CAAC,CAAC,CAAC,CAAC,WAAW,EAAE,CAAC,CAAC;YACxF,OAAO,EAAE,IAAI,EAAE,EAAE,EAAE,QAAQ,EAAE,cAAc,EAAE,CAAC;QAChD,CAAC;QAED,OAAO,EAAE,IAAI,EAAE,EAAE,EAAC,CAAC;IACrB,CAAC;CACF;AA7BD,sCA6BC","sourcesContent":["import { RepresentationMetadata } from '../../../http/representation/RepresentationMetadata';\nimport { BadRequestHttpError } from '../../../util/errors/BadRequestHttpError';\nimport type { EmptyObject } from '../../../util/map/MapUtil';\nimport { SOLID_HTTP } from '../../../util/Vocabularies';\nimport type { CookieStore } from '../account/util/CookieStore';\nimport type { JsonRepresentation } from '../InteractionUtil';\nimport type { JsonInteractionHandlerInput } from '../JsonInteractionHandler';\nimport { JsonInteractionHandler } from '../JsonInteractionHandler';\n\n/**\n * Responsible for logging a user out.\n * In practice this means making sure the cookie is no longer valid.\n */\nexport class LogoutHandler extends JsonInteractionHandler<EmptyObject> {\n  private readonly cookieStore: CookieStore;\n\n  public constructor(cookieStore: CookieStore) {\n    super();\n    this.cookieStore = cookieStore;\n  }\n\n  public async handle(input: JsonInteractionHandlerInput): Promise<JsonRepresentation<EmptyObject>> {\n    const { metadata, accountId, target } = input;\n    const cookie = metadata.get(SOLID_HTTP.terms.accountCookie)?.value;\n    if (cookie) {\n      // Make sure the cookie belongs to the logged-in user.\n      const foundId = await this.cookieStore.get(cookie);\n      if (foundId !== accountId) {\n        throw new BadRequestHttpError('Invalid cookie.');\n      }\n\n      await this.cookieStore.delete(cookie);\n\n      // Setting the expiration time of a cookie to somewhere in the past causes browsers to delete that cookie\n      const outputMetadata = new RepresentationMetadata(target);\n      outputMetadata.set(SOLID_HTTP.terms.accountCookie, cookie);\n      outputMetadata.set(SOLID_HTTP.terms.accountCookieExpiration, new Date(0).toISOString());\n      return { json: {}, metadata: outputMetadata };\n    }\n\n    return { json: {}};\n  }\n}\n"]}