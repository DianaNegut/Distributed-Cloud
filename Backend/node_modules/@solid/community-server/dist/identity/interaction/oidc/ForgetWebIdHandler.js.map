{"version":3,"file":"ForgetWebIdHandler.js","sourceRoot":"","sources":["../../../../src/identity/interaction/oidc/ForgetWebIdHandler.ts"],"names":[],"mappings":";;;AAAA,wEAAqE;AAErE,wDAA2F;AAG3F,sEAAmE;AAEnE;;;GAGG;AACH,MAAa,kBAAmB,SAAQ,+CAA6B;IAClD,eAAe,CAAkB;IAElD,YAAmB,eAAgC;QACjD,KAAK,EAAE,CAAC;QACR,IAAI,CAAC,eAAe,GAAG,eAAe,CAAC;IACzC,CAAC;IAEM,KAAK,CAAC,MAAM,CAAC,EAAE,eAAe,EAA+B;QAClE,IAAA,uCAAqB,EAAC,eAAe,CAAC,CAAC;QAEvC,MAAM,IAAA,6BAAW,EAAC,MAAM,IAAI,CAAC,eAAe,CAAC,WAAW,EAAE,EAAE,eAAe,CAAC,CAAC;QAE7E,2DAA2D;QAC3D,MAAM,QAAQ,GAAG,MAAM,IAAA,mCAAiB,EAAC,eAAe,EAAE,EAAE,EAAE,KAAK,CAAC,CAAC;QAErE,MAAM,IAAI,+BAAc,CAAC,QAAQ,CAAC,CAAC;IACrC,CAAC;CACF;AAlBD,gDAkBC","sourcesContent":["import { FoundHttpError } from '../../../util/errors/FoundHttpError';\nimport type { ProviderFactory } from '../../configuration/ProviderFactory';\nimport { assertOidcInteraction, finishInteraction, forgetWebId } from '../InteractionUtil';\nimport type { JsonRepresentation } from '../InteractionUtil';\nimport type { JsonInteractionHandlerInput } from '../JsonInteractionHandler';\nimport { JsonInteractionHandler } from '../JsonInteractionHandler';\n\n/**\n * Forgets the chosen WebID in an OIDC interaction,\n * causing the next policy trigger to be one where a new WebID has to be chosen.\n */\nexport class ForgetWebIdHandler extends JsonInteractionHandler<never> {\n  private readonly providerFactory: ProviderFactory;\n\n  public constructor(providerFactory: ProviderFactory) {\n    super();\n    this.providerFactory = providerFactory;\n  }\n\n  public async handle({ oidcInteraction }: JsonInteractionHandlerInput): Promise<JsonRepresentation<never>> {\n    assertOidcInteraction(oidcInteraction);\n\n    await forgetWebId(await this.providerFactory.getProvider(), oidcInteraction);\n\n    // Finish the interaction so the policies get checked again\n    const location = await finishInteraction(oidcInteraction, {}, false);\n\n    throw new FoundHttpError(location);\n  }\n}\n"]}