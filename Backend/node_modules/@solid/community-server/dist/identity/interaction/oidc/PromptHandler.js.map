{"version":3,"file":"PromptHandler.js","sourceRoot":"","sources":["../../../../src/identity/interaction/oidc/PromptHandler.ts"],"names":[],"mappings":";;;AAAA,sDAAwD;AACxD,kFAA+E;AAG/E,sEAAmE;AAKnE;;;;;;;;;GASG;AACH,MAAa,aAAc,SAAQ,+CAA+B;IAC/C,MAAM,GAAG,IAAA,sBAAY,EAAC,IAAI,CAAC,CAAC;IAE5B,YAAY,CAAmC;IAEhE,YAAmB,YAA8C;QAC/D,KAAK,EAAE,CAAC;QACR,IAAI,CAAC,YAAY,GAAG,YAAY,CAAC;IACnC,CAAC;IAEM,KAAK,CAAC,MAAM,CAAC,EAAE,eAAe,EAA+B;QAClE,MAAM,MAAM,GAAG,eAAe,EAAE,MAAM,CAAC,IAAI,CAAC;QAC5C,IAAI,MAAM,IAAI,IAAI,CAAC,YAAY,CAAC,MAAM,CAAC,EAAE,CAAC;YACxC,MAAM,QAAQ,GAAG,IAAI,CAAC,YAAY,CAAC,MAAM,CAAC,CAAC,OAAO,EAAE,CAAC;YACrD,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,qBAAqB,MAAM,aAAa,QAAQ,EAAE,CAAC,CAAC;YACtE,mFAAmF;YACnF,OAAO,EAAE,IAAI,EAAE,EAAE,QAAQ,EAAE,MAAM,EAAE,EAAC,CAAC;QACvC,CAAC;QACD,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,+BAA+B,MAAM,EAAE,CAAC,CAAC;QAC1D,MAAM,IAAI,yCAAmB,CAAC,uBAAuB,MAAM,EAAE,CAAC,CAAC;IACjE,CAAC;CACF;AArBD,sCAqBC","sourcesContent":["import { getLoggerFor } from '../../../logging/LogUtil';\nimport { BadRequestHttpError } from '../../../util/errors/BadRequestHttpError';\nimport type { JsonRepresentation } from '../InteractionUtil';\nimport type { JsonInteractionHandlerInput } from '../JsonInteractionHandler';\nimport { JsonInteractionHandler } from '../JsonInteractionHandler';\nimport type { InteractionRoute } from '../routing/InteractionRoute';\n\ntype OutType = { location: string; prompt: string };\n\n/**\n * Redirects requests based on the OIDC Interaction prompt.\n * Errors in case no match was found.\n *\n * The reason we use this intermediate handler\n * instead of letting the OIDC library redirect directly to the correct page,\n * is because that library creates a cookie with of scope of the target page.\n * By having the library always redirect to the index page,\n * the cookie is relevant for all pages and other pages can see if we are still in an interaction.\n */\nexport class PromptHandler extends JsonInteractionHandler<OutType> {\n  private readonly logger = getLoggerFor(this);\n\n  private readonly promptRoutes: Record<string, InteractionRoute>;\n\n  public constructor(promptRoutes: Record<string, InteractionRoute>) {\n    super();\n    this.promptRoutes = promptRoutes;\n  }\n\n  public async handle({ oidcInteraction }: JsonInteractionHandlerInput): Promise<JsonRepresentation<OutType>> {\n    const prompt = oidcInteraction?.prompt.name;\n    if (prompt && this.promptRoutes[prompt]) {\n      const location = this.promptRoutes[prompt].getPath();\n      this.logger.debug(`Current prompt is ${prompt} with URL ${location}`);\n      // Not throwing redirect error since we also want to the prompt to the output json.\n      return { json: { location, prompt }};\n    }\n    this.logger.warn(`Received unsupported prompt ${prompt}`);\n    throw new BadRequestHttpError(`Unsupported prompt: ${prompt}`);\n  }\n}\n"]}