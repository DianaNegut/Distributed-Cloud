{"version":3,"file":"AuthorizedRouteHandler.js","sourceRoot":"","sources":["../../../../src/identity/interaction/routing/AuthorizedRouteHandler.ts"],"names":[],"mappings":";;;AAAA,sDAAwD;AACxD,gFAA6E;AAC7E,sFAAmF;AAQnF,uEAAoE;AAEpE;;;;;;GAMG;AACH,MAAa,sBAAuB,SAAQ,iDAAuC;IAChE,MAAM,GAAG,IAAA,sBAAY,EAAC,IAAI,CAAC,CAAC;IAE7C,YAAmB,KAAqB,EAAE,MAA8B;QACtE,KAAK,CAAC,KAAK,EAAE,MAAM,CAAC,CAAC;IACvB,CAAC;IAEM,KAAK,CAAC,MAAM,CAAC,KAAkC;QACpD,MAAM,EAAE,MAAM,EAAE,SAAS,EAAE,GAAG,KAAK,CAAC;QAEpC,IAAI,CAAC,SAAS,EAAE,CAAC;YACf,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,oBAAoB,MAAM,CAAC,IAAI,wBAAwB,CAAC,CAAC;YAC1E,MAAM,IAAI,6CAAqB,EAAE,CAAC;QACpC,CAAC;QAED,MAAM,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC,SAAS,CAAC,MAAM,CAAC,IAAI,CAAE,CAAC;QACjD,IAAI,KAAK,CAAC,SAAS,KAAK,SAAS,EAAE,CAAC;YAClC,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,oBAAoB,MAAM,CAAC,IAAI,8BAA8B,SAAS,EAAE,CAAC,CAAC;YAC3F,MAAM,IAAI,uCAAkB,EAAE,CAAC;QACjC,CAAC;QAED,OAAO,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;IACnC,CAAC;CACF;AAvBD,wDAuBC","sourcesContent":["import { getLoggerFor } from '../../../logging/LogUtil';\nimport { ForbiddenHttpError } from '../../../util/errors/ForbiddenHttpError';\nimport { UnauthorizedHttpError } from '../../../util/errors/UnauthorizedHttpError';\nimport type { AccountIdRoute } from '../account/AccountIdRoute';\nimport type { JsonRepresentation } from '../InteractionUtil';\nimport type {\n  JsonInteractionHandler,\n  JsonInteractionHandlerInput,\n\n} from '../JsonInteractionHandler';\nimport { InteractionRouteHandler } from './InteractionRouteHandler';\n\n/**\n * An {@link InteractionRouteHandler} specifically for an {@link AccountIdRoute}.\n * If there is no account ID, implying the user is not logged in,\n * an {@link UnauthorizedHttpError} will be thrown.\n * If there is an account ID, but it does not match the one in target resource,\n * a {@link ForbiddenHttpError} will be thrown.\n */\nexport class AuthorizedRouteHandler extends InteractionRouteHandler<AccountIdRoute> {\n  private readonly logger = getLoggerFor(this);\n\n  public constructor(route: AccountIdRoute, source: JsonInteractionHandler) {\n    super(route, source);\n  }\n\n  public async handle(input: JsonInteractionHandlerInput): Promise<JsonRepresentation> {\n    const { target, accountId } = input;\n\n    if (!accountId) {\n      this.logger.warn(`Trying to access ${target.path} without authorization`);\n      throw new UnauthorizedHttpError();\n    }\n\n    const match = this.route.matchPath(target.path)!;\n    if (match.accountId !== accountId) {\n      this.logger.warn(`Trying to access ${target.path} with wrong authorization: ${accountId}`);\n      throw new ForbiddenHttpError();\n    }\n\n    return this.source.handle(input);\n  }\n}\n"]}