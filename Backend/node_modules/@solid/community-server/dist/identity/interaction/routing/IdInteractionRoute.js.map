{"version":3,"file":"IdInteractionRoute.js","sourceRoot":"","sources":["../../../../src/identity/interaction/routing/IdInteractionRoute.ts"],"names":[],"mappings":";;;AAAA,kFAA+E;AAC/E,qDAAsE;AAGtE;;GAEG;AACH,MAAa,kBAAkB;IACZ,IAAI,CAA0B;IAC9B,MAAM,CAAM;IACZ,WAAW,CAAU;IACrB,UAAU,CAAS;IAEpC,YAAmB,IAA6B,EAAE,MAAW,EAAE,WAAW,GAAG,IAAI;QAC/E,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC;QACjB,IAAI,CAAC,MAAM,GAAG,MAAM,CAAC;QACrB,IAAI,CAAC,WAAW,GAAG,WAAW,CAAC;QAC/B,IAAI,CAAC,UAAU,GAAG,WAAW,CAAC,CAAC,CAAC,mBAAmB,CAAC,CAAC,CAAC,iBAAiB,CAAC;IAC1E,CAAC;IAEM,OAAO,CAAC,UAAwC;QACrD,MAAM,EAAE,GAAG,UAAU,EAAE,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;QACrC,IAAI,CAAC,EAAE,EAAE,CAAC;YACR,MAAM,IAAI,yCAAmB,CAAC,WAAW,IAAI,CAAC,MAAM,wDAAwD,CAAC,CAAC;QAChH,CAAC;QAED,MAAM,IAAI,GAAG,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,UAAU,CAAC,CAAC;QAC3C,OAAO,IAAA,kBAAO,EAAC,IAAI,EAAE,IAAI,CAAC,WAAW,CAAC,CAAC,CAAC,IAAA,8BAAmB,EAAC,EAAE,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC;IACxE,CAAC;IAEM,SAAS,CAAC,IAAY;QAC3B,MAAM,KAAK,GAAG,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QAEzC,IAAI,CAAC,KAAK,EAAE,CAAC;YACX,OAAO;QACT,CAAC;QAED,MAAM,EAAE,GAAG,KAAK,CAAC,CAAC,CAAC,CAAC;QACpB,MAAM,IAAI,GAAG,KAAK,CAAC,CAAC,CAAC,CAAC;QAEtB,MAAM,cAAc,GAAG,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,CAAC;QAEjD,IAAI,CAAC,cAAc,EAAE,CAAC;YACpB,OAAO;QACT,CAAC;QAED,iGAAiG;QACjG,uDAAuD;QACvD,OAAO,EAAE,GAAG,cAAc,EAAE,CAAC,IAAI,CAAC,MAAM,CAAC,EAAE,EAAE,EAAiC,CAAC;IACjF,CAAC;CACF;AA3CD,gDA2CC","sourcesContent":["import { InternalServerError } from '../../../util/errors/InternalServerError';\nimport { ensureTrailingSlash, joinUrl } from '../../../util/PathUtil';\nimport type { InteractionRoute } from './InteractionRoute';\n\n/**\n * An {@link InteractionRoute} for routes that have a dynamic identifier in their path.\n */\nexport class IdInteractionRoute<TBase extends string, TId extends string> implements InteractionRoute<TBase | TId> {\n  private readonly base: InteractionRoute<TBase>;\n  private readonly idName: TId;\n  private readonly ensureSlash: boolean;\n  private readonly matchRegex: RegExp;\n\n  public constructor(base: InteractionRoute<TBase>, idName: TId, ensureSlash = true) {\n    this.base = base;\n    this.idName = idName;\n    this.ensureSlash = ensureSlash;\n    this.matchRegex = ensureSlash ? /(.*\\/)([^/]+)\\/$/u : /(.*\\/)([^/]+)$/u;\n  }\n\n  public getPath(parameters?: Record<TBase | TId, string>): string {\n    const id = parameters?.[this.idName];\n    if (!id) {\n      throw new InternalServerError(`Missing ${this.idName} from getPath call. This implies a misconfigured path.`);\n    }\n\n    const path = this.base.getPath(parameters);\n    return joinUrl(path, this.ensureSlash ? ensureTrailingSlash(id) : id);\n  }\n\n  public matchPath(path: string): Record<TBase | TId, string> | undefined {\n    const match = this.matchRegex.exec(path);\n\n    if (!match) {\n      return;\n    }\n\n    const id = match[2];\n    const head = match[1];\n\n    const baseParameters = this.base.matchPath(head);\n\n    if (!baseParameters) {\n      return;\n    }\n\n    // Cast needed because TS always assumes type is { [x: string]: string; } when using [] like this\n    // https://github.com/microsoft/TypeScript/issues/13948\n    return { ...baseParameters, [this.idName]: id } as Record<TBase | TId, string>;\n  }\n}\n"]}