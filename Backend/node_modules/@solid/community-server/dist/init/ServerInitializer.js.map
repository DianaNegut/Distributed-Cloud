{"version":3,"file":"ServerInitializer.js","sourceRoot":"","sources":["../../src/init/ServerInitializer.ts"],"names":[],"mappings":";;;AACA,yCAAsC;AACtC,gDAAkD;AAClD,mEAA4D;AAG5D,+CAA4C;AAE5C;;GAEG;AACH,MAAa,iBAAkB,SAAQ,yBAAW;IAC7B,MAAM,GAAG,IAAA,sBAAY,EAAC,IAAI,CAAC,CAAC;IAE9B,aAAa,CAAoB;IACjC,IAAI,CAAU;IACd,UAAU,CAAU;IAE7B,MAAM,CAAU;IAExB,YAAmB,aAAgC,EAAE,IAAa,EAAE,UAAmB;QACrF,KAAK,EAAE,CAAC;QACR,IAAI,CAAC,aAAa,GAAG,aAAa,CAAC;QACnC,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC;QACjB,IAAI,CAAC,UAAU,GAAG,UAAU,CAAC;QAC7B,IAAI,CAAC,IAAI,IAAI,CAAC,UAAU,EAAE,CAAC;YACzB,MAAM,IAAI,KAAK,CAAC,6CAA6C,CAAC,CAAC;QACjE,CAAC;IACH,CAAC;IAEM,KAAK,CAAC,MAAM;QACjB,IAAI,CAAC,MAAM,GAAG,MAAM,IAAI,CAAC,aAAa,CAAC,YAAY,EAAE,CAAC;QAEtD,IAAI,IAAI,CAAC,UAAU,EAAE,CAAC;YACpB,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,0BAA0B,IAAI,CAAC,MAAM,CAAC,OAAO,EAAY,EAAE,CAAC,CAAC;YAC9E,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;QACtC,CAAC;aAAM,CAAC;YACN,MAAM,GAAG,GAAG,IAAI,GAAG,CAAC,OAAO,IAAA,iCAAa,EAAC,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,gBAAgB,IAAI,CAAC,IAAI,GAAG,CAAC,CAAC,IAAI,CAAC;YACnG,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,0BAA0B,GAAG,EAAE,CAAC,CAAC;YAClD,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QAChC,CAAC;IACH,CAAC;IAEM,KAAK,CAAC,QAAQ;QACnB,IAAI,IAAI,CAAC,MAAM,EAAE,CAAC;YAChB,OAAO,IAAA,qBAAS,EAAC,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,EAAE,CAAC;QAC1D,CAAC;IACH,CAAC;CACF;AArCD,8CAqCC","sourcesContent":["import type { Server } from 'node:http';\nimport { promisify } from 'node:util';\nimport { getLoggerFor } from '../logging/LogUtil';\nimport { isHttpsServer } from '../server/HttpServerFactory';\nimport type { HttpServerFactory } from '../server/HttpServerFactory';\nimport type { Finalizable } from './final/Finalizable';\nimport { Initializer } from './Initializer';\n\n/**\n * Creates and starts an HTTP server.\n */\nexport class ServerInitializer extends Initializer implements Finalizable {\n  protected readonly logger = getLoggerFor(this);\n\n  private readonly serverFactory: HttpServerFactory;\n  private readonly port?: number;\n  private readonly socketPath?: string;\n\n  private server?: Server;\n\n  public constructor(serverFactory: HttpServerFactory, port?: number, socketPath?: string) {\n    super();\n    this.serverFactory = serverFactory;\n    this.port = port;\n    this.socketPath = socketPath;\n    if (!port && !socketPath) {\n      throw new Error('Either Port or Socket arguments must be set');\n    }\n  }\n\n  public async handle(): Promise<void> {\n    this.server = await this.serverFactory.createServer();\n\n    if (this.socketPath) {\n      this.logger.info(`Listening to server at ${this.server.address() as string}`);\n      this.server.listen(this.socketPath);\n    } else {\n      const url = new URL(`http${isHttpsServer(this.server) ? 's' : ''}://localhost:${this.port}/`).href;\n      this.logger.info(`Listening to server at ${url}`);\n      this.server.listen(this.port);\n    }\n  }\n\n  public async finalize(): Promise<void> {\n    if (this.server) {\n      return promisify(this.server.close.bind(this.server))();\n    }\n  }\n}\n"]}