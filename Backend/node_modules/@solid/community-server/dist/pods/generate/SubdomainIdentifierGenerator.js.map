{"version":3,"file":"SubdomainIdentifierGenerator.js","sourceRoot":"","sources":["../../../src/pods/generate/SubdomainIdentifierGenerator.ts"],"names":[],"mappings":";;;AACA,+EAA4E;AAC5E,kDAAyE;AACzE,sDAAwD;AAGxD;;;;;GAKG;AACH,MAAa,4BAA4B;IACtB,SAAS,CAAmC;IAE7D,YAAmB,OAAe;QAChC,IAAI,CAAC,SAAS,GAAG,IAAA,wBAAa,EAAC,IAAA,8BAAmB,EAAC,OAAO,CAAC,CAAC,CAAC;IAC/D,CAAC;IAEM,QAAQ,CAAC,IAAY;QAC1B,mFAAmF;QACnF,MAAM,SAAS,GAAG,IAAA,4BAAe,EAAC,IAAI,CAAC,CAAC,WAAW,EAAE,CAAC;QACtD,OAAO,EAAE,IAAI,EAAE,GAAG,IAAI,CAAC,SAAS,CAAC,MAAM,GAAG,SAAS,IAAI,IAAI,CAAC,SAAS,CAAC,IAAI,EAAE,EAAE,CAAC;IACjF,CAAC;IAEM,UAAU,CAAC,UAA8B;QAC9C,MAAM,EAAE,IAAI,EAAE,GAAG,UAAU,CAAC;QAE5B,yEAAyE;QACzE,uCAAuC;QACvC,IAAI,CAAC,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC,EAAE,CAAC;YAC5C,MAAM,IAAI,yCAAmB,CAAC,sBAAsB,IAAI,EAAE,CAAC,CAAC;QAC9D,CAAC;QAED,MAAM,GAAG,GAAG,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,CAAC;QAE9C,sDAAsD;QACtD,IAAI,GAAG,GAAG,CAAC,EAAE,CAAC;YACZ,MAAM,IAAI,yCAAmB,CAAC,sBAAsB,IAAI,EAAE,CAAC,CAAC;QAC9D,CAAC;QAED,8CAA8C;QAC9C,OAAO,EAAE,IAAI,EAAE,IAAI,CAAC,KAAK,CAAC,CAAC,EAAE,GAAG,GAAG,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,MAAM,CAAC,EAAE,CAAC;IACnE,CAAC;CACF;AAhCD,oEAgCC","sourcesContent":["import type { ResourceIdentifier } from '../../http/representation/ResourceIdentifier';\nimport { BadRequestHttpError } from '../../util/errors/BadRequestHttpError';\nimport { ensureTrailingSlash, extractScheme } from '../../util/PathUtil';\nimport { sanitizeUrlPart } from '../../util/StringUtil';\nimport type { IdentifierGenerator } from './IdentifierGenerator';\n\n/**\n * Generates identifiers by using the name as a subdomain on the base URL.\n * Non-alphanumeric characters will be replaced with `-`.\n *\n * When extracting the pod, the base URl is also seen as a pod as there is no issue of nested containers here.\n */\nexport class SubdomainIdentifierGenerator implements IdentifierGenerator {\n  private readonly baseParts: { scheme: string; rest: string };\n\n  public constructor(baseUrl: string) {\n    this.baseParts = extractScheme(ensureTrailingSlash(baseUrl));\n  }\n\n  public generate(name: string): ResourceIdentifier {\n    // Using the punycode converter is a risk as it doesn't convert slashes for example\n    const cleanName = sanitizeUrlPart(name).toLowerCase();\n    return { path: `${this.baseParts.scheme}${cleanName}.${this.baseParts.rest}` };\n  }\n\n  public extractPod(identifier: ResourceIdentifier): ResourceIdentifier {\n    const { path } = identifier;\n\n    // Invalid identifiers that have no result should never reach this point,\n    // but some safety checks just in case.\n    if (!path.startsWith(this.baseParts.scheme)) {\n      throw new BadRequestHttpError(`Invalid identifier ${path}`);\n    }\n\n    const idx = path.indexOf(this.baseParts.rest);\n\n    // If the idx is smaller than this, there was no match\n    if (idx < 0) {\n      throw new BadRequestHttpError(`Invalid identifier ${path}`);\n    }\n\n    // Slice of everything after the base URL tail\n    return { path: path.slice(0, idx + this.baseParts.rest.length) };\n  }\n}\n"]}