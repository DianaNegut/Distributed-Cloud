{"version":3,"file":"SuffixIdentifierGenerator.js","sourceRoot":"","sources":["../../../src/pods/generate/SuffixIdentifierGenerator.ts"],"names":[],"mappings":";;;AACA,+EAA4E;AAC5E,kDAA0D;AAC1D,sDAAwD;AAGxD;;;GAGG;AACH,MAAa,yBAAyB;IACnB,IAAI,CAAS;IAE9B,YAAmB,IAAY;QAC7B,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC;IACnB,CAAC;IAEM,QAAQ,CAAC,IAAY;QAC1B,MAAM,SAAS,GAAG,IAAA,4BAAe,EAAC,IAAI,CAAC,CAAC,WAAW,EAAE,CAAC;QACtD,OAAO,EAAE,IAAI,EAAE,IAAA,8BAAmB,EAAC,IAAI,GAAG,CAAC,SAAS,EAAE,IAAI,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,EAAE,CAAC;IAC3E,CAAC;IAEM,UAAU,CAAC,UAA8B;QAC9C,MAAM,EAAE,IAAI,EAAE,GAAG,UAAU,CAAC;QAE5B,yEAAyE;QACzE,uCAAuC;QACvC,IAAI,CAAC,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE,CAAC;YAChC,MAAM,IAAI,yCAAmB,CAAC,sBAAsB,IAAI,EAAE,CAAC,CAAC;QAC9D,CAAC;QAED,+EAA+E;QAC/E,MAAM,GAAG,GAAG,IAAI,CAAC,OAAO,CAAC,GAAG,EAAE,IAAI,CAAC,IAAI,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC;QAEpD,IAAI,GAAG,GAAG,CAAC,EAAE,CAAC;YACZ,MAAM,IAAI,yCAAmB,CAAC,sBAAsB,IAAI,EAAE,CAAC,CAAC;QAC9D,CAAC;QAED,gDAAgD;QAChD,OAAO,EAAE,IAAI,EAAE,IAAI,CAAC,KAAK,CAAC,CAAC,EAAE,GAAG,GAAG,CAAC,CAAC,EAAE,CAAC;IAC1C,CAAC;CACF;AA/BD,8DA+BC","sourcesContent":["import type { ResourceIdentifier } from '../../http/representation/ResourceIdentifier';\nimport { BadRequestHttpError } from '../../util/errors/BadRequestHttpError';\nimport { ensureTrailingSlash } from '../../util/PathUtil';\nimport { sanitizeUrlPart } from '../../util/StringUtil';\nimport type { IdentifierGenerator } from './IdentifierGenerator';\n\n/**\n * Generates identifiers by appending the name to a stored base identifier.\n * Non-alphanumeric characters will be replaced with `-`.\n */\nexport class SuffixIdentifierGenerator implements IdentifierGenerator {\n  private readonly base: string;\n\n  public constructor(base: string) {\n    this.base = base;\n  }\n\n  public generate(name: string): ResourceIdentifier {\n    const cleanName = sanitizeUrlPart(name).toLowerCase();\n    return { path: ensureTrailingSlash(new URL(cleanName, this.base).href) };\n  }\n\n  public extractPod(identifier: ResourceIdentifier): ResourceIdentifier {\n    const { path } = identifier;\n\n    // Invalid identifiers that have no result should never reach this point,\n    // but some safety checks just in case.\n    if (!path.startsWith(this.base)) {\n      throw new BadRequestHttpError(`Invalid identifier ${path}`);\n    }\n\n    // The first slash after the base URL indicates the first container on the path\n    const idx = path.indexOf('/', this.base.length + 1);\n\n    if (idx < 0) {\n      throw new BadRequestHttpError(`Invalid identifier ${path}`);\n    }\n\n    // Slice of everything after the first container\n    return { path: path.slice(0, idx + 1) };\n  }\n}\n"]}