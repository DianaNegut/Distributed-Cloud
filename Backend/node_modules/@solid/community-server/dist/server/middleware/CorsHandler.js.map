{"version":3,"file":"CorsHandler.js","sourceRoot":"","sources":["../../../src/server/middleware/CorsHandler.ts"],"names":[],"mappings":";;;;;;AAAA,gDAAwB;AAGxB,gDAA6C;AAE7C,MAAM,cAAc,GAAgB;IAClC,MAAM,EAAE,CAAC,MAA0B,EAAE,QAAsD,EAAQ,EAAE,CACnG,QAAQ,CAAC,IAAI,EAAE,MAAM,IAAI,GAAG,CAAC;CAChC,CAAC;AAcF;;;;;;;;;GASG;AACH,MAAa,WAAY,SAAQ,yBAAW;IACzB,WAAW,CAQlB;IAEV,YAAmB,UAA6B,EAAE;QAChD,KAAK,EAAE,CAAC;QACR,IAAI,CAAC,WAAW,GAAG,IAAA,cAAI,EAAC,EAAE,GAAG,cAAc,EAAE,GAAG,OAAO,EAAE,CAAC,CAAC;IAC7D,CAAC;IAEM,KAAK,CAAC,MAAM,CAAC,KAAuB;QACzC,OAAO,IAAI,OAAO,CAAC,CAAC,OAAO,EAAQ,EAAE;YACnC,IAAI,CAAC,WAAW,CAAC,KAAK,CAAC,OAAO,EAAE,KAAK,CAAC,QAAQ,EAAE,GAAS,EAAE,CAAC,OAAO,EAAE,CAAC,CAAC;QACzE,CAAC,CAAC,CAAC;IACL,CAAC;CACF;AArBD,kCAqBC","sourcesContent":["import cors from 'cors';\nimport type { CorsOptions, CorsRequest } from 'cors';\nimport type { HttpHandlerInput } from '../HttpHandler';\nimport { HttpHandler } from '../HttpHandler';\n\nconst defaultOptions: CorsOptions = {\n  origin: (origin: string | undefined, callback: (err: Error | null, origin?: string) => void): void =>\n    callback(null, origin ?? '*'),\n};\n\n// Components.js does not support the full CorsOptions yet\ninterface SimpleCorsOptions {\n  origin?: string;\n  methods?: string[];\n  allowedHeaders?: string[];\n  exposedHeaders?: string[];\n  credentials?: boolean;\n  maxAge?: number;\n  preflightContinue?: boolean;\n  optionsSuccessStatus?: number;\n}\n\n/**\n * Handler that sets CORS options on the response.\n * In case of an OPTIONS request this handler will close the connection after adding its headers\n * if `preflightContinue` is set to `false`.\n *\n * Solid, ยง8.1: \"A server MUST implement the CORS protocol [FETCH] such that, to the extent possible,\n * the browser allows Solid apps to send any request and combination of request headers to the server,\n * and the Solid app can read any response and response headers received from the server.\"\n * Full details: https://solidproject.org/TR/2021/protocol-20211217#cors-server\n */\nexport class CorsHandler extends HttpHandler {\n  private readonly corsHandler: (\n    req: CorsRequest,\n    res: {\n      statusCode?: number;\n      setHeader: (key: string, value: string) => unknown;\n      end: () => unknown;\n    },\n    next: (err?: unknown) => unknown,\n  ) => void;\n\n  public constructor(options: SimpleCorsOptions = {}) {\n    super();\n    this.corsHandler = cors({ ...defaultOptions, ...options });\n  }\n\n  public async handle(input: HttpHandlerInput): Promise<void> {\n    return new Promise((resolve): void => {\n      this.corsHandler(input.request, input.response, (): void => resolve());\n    });\n  }\n}\n"]}