{"version":3,"file":"StreamingHttpMetadataWriter.js","sourceRoot":"","sources":["../../../../src/server/notifications/StreamingHttpChannel2023/StreamingHttpMetadataWriter.ts"],"names":[],"mappings":";;;AAAA,sDAAwD;AAExD,yDAAqD;AACrD,qDAAiD;AAGjD,iFAA8E;AAE9E;;;GAGG;AACH,MAAa,2BAA4B,SAAQ,+BAAc;IAI1C;IAHA,MAAM,GAAG,IAAA,sBAAY,EAAC,IAAI,CAAC,CAAC;IAE/C,YACmB,KAAuB;QAExC,KAAK,EAAE,CAAC;QAFS,UAAK,GAAL,KAAK,CAAkB;IAG1C,CAAC;IAEM,KAAK,CAAC,MAAM,CAAC,KAAmE;QACrF,MAAM,UAAU,GAAG,kBAAkB,CAAC,KAAK,CAAC,QAAQ,CAAC,UAAU,CAAC,KAAK,CAAC,CAAC;QACvE,MAAM,WAAW,GAAG,IAAA,kBAAO,EAAC,IAAI,CAAC,KAAK,CAAC,OAAO,EAAE,EAAE,UAAU,CAAC,CAAC;QAC9D,MAAM,IAAI,GAAG,IAAI,WAAW,uEAAuE,CAAC;QACpG,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,wDAAwD,CAAC,CAAC;QAC5E,IAAA,sBAAS,EAAC,KAAK,CAAC,QAAQ,EAAE,MAAM,EAAE,IAAI,CAAC,CAAC;IAC1C,CAAC;CACF;AAhBD,kEAgBC","sourcesContent":["import { getLoggerFor } from '../../../logging/LogUtil';\nimport type { HttpResponse } from '../../HttpResponse';\nimport { addHeader } from '../../../util/HeaderUtil';\nimport { joinUrl } from '../../../util/PathUtil';\nimport type { InteractionRoute } from '../../../identity/interaction/routing/InteractionRoute';\nimport type { RepresentationMetadata } from '../../../http/representation/RepresentationMetadata';\nimport { MetadataWriter } from '../../../http/output/metadata/MetadataWriter';\n\n/**\n * A {@link MetadataWriter} that adds a link to the receiveFrom endpoint\n * of the corresponding Streaming HTTP notifications channel\n */\nexport class StreamingHttpMetadataWriter extends MetadataWriter {\n  protected readonly logger = getLoggerFor(this);\n\n  public constructor(\n    private readonly route: InteractionRoute,\n  ) {\n    super();\n  }\n\n  public async handle(input: { response: HttpResponse; metadata: RepresentationMetadata }): Promise<void> {\n    const encodedUrl = encodeURIComponent(input.metadata.identifier.value);\n    const receiveFrom = joinUrl(this.route.getPath(), encodedUrl);\n    const link = `<${receiveFrom}>; rel=\"http://www.w3.org/ns/solid/terms#updatesViaStreamingHttp2023\"`;\n    this.logger.debug('Adding updatesViaStreamingHttp2023  to the Link header');\n    addHeader(input.response, 'Link', link);\n  }\n}\n"]}