{"version":3,"file":"WebSocket2023Util.js","sourceRoot":"","sources":["../../../../src/server/notifications/WebSocketChannel2023/WebSocket2023Util.ts"],"names":[],"mappings":";;AAQA,oDAEC;AAQD,sDAcC;AA/BD,kFAA+E;AAE/E;;;;GAIG;AACH,SAAgB,oBAAoB,CAAC,EAAU;IAC7C,OAAO,KAAK,EAAE,CAAC,KAAK,CAAC,MAAM,CAAC,MAAM,CAAC,EAAE,CAAC;AACxC,CAAC;AAED;;;;;GAKG;AACH,SAAgB,qBAAqB,CAAC,OAAe,EAAE,OAAwB;IAC7E,MAAM,IAAI,GAAG,OAAO,CAAC,GAAG,CAAC;IAEzB,IAAI,CAAC,IAAI,EAAE,CAAC;QACV,MAAM,IAAI,yCAAmB,CAAC,4CAA4C,CAAC,CAAC;IAC9E,CAAC;IAED,kFAAkF;IAClF,MAAM,EAAE,GAAG,IAAI,GAAG,CAAC,IAAI,EAAE,oBAAoB,CAAC,CAAC;IAC/C,MAAM,IAAI,GAAG,IAAI,GAAG,CAAC,OAAO,CAAC,CAAC;IAC9B,EAAE,CAAC,IAAI,GAAG,IAAI,CAAC,IAAI,CAAC;IACpB,EAAE,CAAC,QAAQ,GAAG,IAAI,CAAC,QAAQ,CAAC;IAE5B,OAAO,EAAE,CAAC,IAAI,CAAC;AACjB,CAAC","sourcesContent":["import type { IncomingMessage } from 'node:http';\nimport { BadRequestHttpError } from '../../../util/errors/BadRequestHttpError';\n\n/**\n * Generates a WebSocket URL by converting an HTTP(S) URL into a WS(S) URL.\n *\n * @param id - The identifier of the channel. Needs to be a URL.\n */\nexport function generateWebSocketUrl(id: string): string {\n  return `ws${id.slice('http'.length)}`;\n}\n\n/**\n * Parses a {@link IncomingMessage} to extract its path used for authentication.\n *\n * @param baseUrl - The base URL of the server.\n * @param request - The request to parse.\n */\nexport function parseWebSocketRequest(baseUrl: string, request: IncomingMessage): string {\n  const path = request.url;\n\n  if (!path) {\n    throw new BadRequestHttpError('Missing url parameter in WebSocket request');\n  }\n\n  // Use dummy base and then explicitly set the host and protocol from the base URL.\n  const id = new URL(path, 'http://example.com');\n  const base = new URL(baseUrl);\n  id.host = base.host;\n  id.protocol = base.protocol;\n\n  return id.href;\n}\n"]}