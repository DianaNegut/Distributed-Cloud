"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.WebhookWebId = void 0;
const n3_1 = require("n3");
const OkResponseDescription_1 = require("../../../http/output/response/OkResponseDescription");
const BasicRepresentation_1 = require("../../../http/representation/BasicRepresentation");
const ContentTypes_1 = require("../../../util/ContentTypes");
const ErrorUtil_1 = require("../../../util/errors/ErrorUtil");
const PathUtil_1 = require("../../../util/PathUtil");
const OperationHttpHandler_1 = require("../../OperationHttpHandler");
/**
 * Generates a fixed WebID that we use to identify the server for notifications sent using a WebhookChannel2023.
 * This is used in tandem with the tokens generated by the {@link WebhookEmitter}.
 * This is a minimal WebID with only the `solid:oidcIssuer` triple.
 */
class WebhookWebId extends OperationHttpHandler_1.OperationHttpHandler {
    turtle;
    constructor(baseUrl) {
        super();
        this.turtle = `@prefix solid: <http://www.w3.org/ns/solid/terms#>.
<> solid:oidcIssuer <${(0, PathUtil_1.trimTrailingSlashes)(baseUrl)}>.`;
        // This will throw an error if something is wrong with the issuer URL
        const parser = new n3_1.Parser();
        try {
            parser.parse(this.turtle);
        }
        catch (error) {
            throw new Error(`Invalid issuer URL: ${(0, ErrorUtil_1.createErrorMessage)(error)}`);
        }
    }
    async handle(input) {
        const representation = new BasicRepresentation_1.BasicRepresentation(this.turtle, input.operation.target, ContentTypes_1.TEXT_TURTLE);
        return new OkResponseDescription_1.OkResponseDescription(representation.metadata, representation.data);
    }
}
exports.WebhookWebId = WebhookWebId;
//# sourceMappingURL=WebhookWebId.js.map