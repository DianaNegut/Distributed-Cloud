{"version":3,"file":"WebhookWebId.js","sourceRoot":"","sources":["../../../../src/server/notifications/WebhookChannel2023/WebhookWebId.ts"],"names":[],"mappings":";;;AAAA,2BAA4B;AAC5B,+FAA4F;AAE5F,0FAAuF;AACvF,6DAAyD;AACzD,8DAAoE;AACpE,qDAA6D;AAE7D,qEAAkE;AAElE;;;;GAIG;AACH,MAAa,YAAa,SAAQ,2CAAoB;IACnC,MAAM,CAAS;IAEhC,YAAmB,OAAe;QAChC,KAAK,EAAE,CAAC;QAER,IAAI,CAAC,MAAM,GAAG;uBACK,IAAA,8BAAmB,EAAC,OAAO,CAAC,IAAI,CAAC;QAEpD,qEAAqE;QACrE,MAAM,MAAM,GAAG,IAAI,WAAM,EAAE,CAAC;QAC5B,IAAI,CAAC;YACH,MAAM,CAAC,KAAK,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;QAC5B,CAAC;QAAC,OAAO,KAAc,EAAE,CAAC;YACxB,MAAM,IAAI,KAAK,CAAC,uBAAuB,IAAA,8BAAkB,EAAC,KAAK,CAAC,EAAE,CAAC,CAAC;QACtE,CAAC;IACH,CAAC;IAEM,KAAK,CAAC,MAAM,CAAC,KAAgC;QAClD,MAAM,cAAc,GAAG,IAAI,yCAAmB,CAAC,IAAI,CAAC,MAAM,EAAE,KAAK,CAAC,SAAS,CAAC,MAAM,EAAE,0BAAW,CAAC,CAAC;QACjG,OAAO,IAAI,6CAAqB,CAAC,cAAc,CAAC,QAAQ,EAAE,cAAc,CAAC,IAAI,CAAC,CAAC;IACjF,CAAC;CACF;AAtBD,oCAsBC","sourcesContent":["import { Parser } from 'n3';\nimport { OkResponseDescription } from '../../../http/output/response/OkResponseDescription';\nimport type { ResponseDescription } from '../../../http/output/response/ResponseDescription';\nimport { BasicRepresentation } from '../../../http/representation/BasicRepresentation';\nimport { TEXT_TURTLE } from '../../../util/ContentTypes';\nimport { createErrorMessage } from '../../../util/errors/ErrorUtil';\nimport { trimTrailingSlashes } from '../../../util/PathUtil';\nimport type { OperationHttpHandlerInput } from '../../OperationHttpHandler';\nimport { OperationHttpHandler } from '../../OperationHttpHandler';\n\n/**\n * Generates a fixed WebID that we use to identify the server for notifications sent using a WebhookChannel2023.\n * This is used in tandem with the tokens generated by the {@link WebhookEmitter}.\n * This is a minimal WebID with only the `solid:oidcIssuer` triple.\n */\nexport class WebhookWebId extends OperationHttpHandler {\n  private readonly turtle: string;\n\n  public constructor(baseUrl: string) {\n    super();\n\n    this.turtle = `@prefix solid: <http://www.w3.org/ns/solid/terms#>.\n<> solid:oidcIssuer <${trimTrailingSlashes(baseUrl)}>.`;\n\n    // This will throw an error if something is wrong with the issuer URL\n    const parser = new Parser();\n    try {\n      parser.parse(this.turtle);\n    } catch (error: unknown) {\n      throw new Error(`Invalid issuer URL: ${createErrorMessage(error)}`);\n    }\n  }\n\n  public async handle(input: OperationHttpHandlerInput): Promise<ResponseDescription> {\n    const representation = new BasicRepresentation(this.turtle, input.operation.target, TEXT_TURTLE);\n    return new OkResponseDescription(representation.metadata, representation.data);\n  }\n}\n"]}