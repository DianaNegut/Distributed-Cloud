{"version":3,"file":"Base64EncodingStorage.js","sourceRoot":"","sources":["../../../src/storage/keyvalue/Base64EncodingStorage.ts"],"names":[],"mappings":";;;AACA,6EAA0E;AAE1E;;;GAGG;AACH,MAAa,qBAAyB,SAAQ,uDAA6B;IACzE,YAAmB,MAAkC;QACnD,KAAK,CAAC,MAAM,CAAC,CAAC;IAChB,CAAC;IAES,QAAQ,CAAC,GAAW;QAC5B,OAAO,MAAM,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC;IAC7C,CAAC;IAES,aAAa,CAAC,GAAW;QACjC,+GAA+G;QAC/G,kDAAkD;QAClD,gEAAgE;QAChE,uEAAuE;QACvE,+GAA+G;QAC/G,gGAAgG;QAChG,qFAAqF;QACrF,mDAAmD;QACnD,OAAO,MAAM,CAAC,IAAI,CAAC,kBAAkB,CAAC,GAAG,CAAC,EAAE,QAAQ,CAAC,CAAC,QAAQ,CAAC,OAAO,CAAC,CAAC;IAC1E,CAAC;CACF;AApBD,sDAoBC","sourcesContent":["import type { KeyValueStorage } from './KeyValueStorage';\nimport { PassthroughKeyValueStorage } from './PassthroughKeyValueStorage';\n\n/**\n * Encodes the input key with base64 encoding,\n * to make sure there are no invalid or special path characters.\n */\nexport class Base64EncodingStorage<T> extends PassthroughKeyValueStorage<T> {\n  public constructor(source: KeyValueStorage<string, T>) {\n    super(source);\n  }\n\n  protected toNewKey(key: string): string {\n    return Buffer.from(key).toString('base64');\n  }\n\n  protected toOriginalKey(key: string): string {\n    // While the main part of a base64 encoded string is same from any changes from encoding or decoding URL parts,\n    // the `=` symbol that is used for padding is not.\n    // This can cause incorrect results when calling these function,\n    // where the original path contains `YXBwbGU%3D` instead of `YXBwbGU=`.\n    // This does not create any issues when the source store does not encode the string, so is safe to always call.\n    // For consistency, we might want to also always encode when creating the path in `keyToPath()`,\n    // but that would potentially break existing implementations that do not do encoding,\n    // and is not really necessary to solve any issues.\n    return Buffer.from(decodeURIComponent(key), 'base64').toString('utf-8');\n  }\n}\n"]}