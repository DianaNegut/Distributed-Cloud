{"version":3,"file":"ContainerPathStorage.js","sourceRoot":"","sources":["../../../src/storage/keyvalue/ContainerPathStorage.ts"],"names":[],"mappings":";;;AAAA,kDAAuF;AAEvF,6EAA0E;AAE1E;;;GAGG;AACH,MAAa,oBAAwB,SAAQ,uDAA6B;IACrD,QAAQ,CAAS;IAEpC,YAAmB,MAAkC,EAAE,YAAoB;QACzE,KAAK,CAAC,MAAM,CAAC,CAAC;QACd,IAAI,CAAC,QAAQ,GAAG,IAAA,6BAAkB,EAAC,IAAA,8BAAmB,EAAC,YAAY,CAAC,CAAC,CAAC;IACxE,CAAC;IAEM,KAAK,CAAA,CAAE,OAAO;QACnB,IAAI,KAAK,EAAE,MAAM,CAAE,GAAG,EAAE,KAAK,CAAE,IAAI,IAAI,CAAC,MAAM,CAAC,OAAO,EAAE,EAAE,CAAC;YACzD,qFAAqF;YACrF,IAAI,CAAC,GAAG,CAAC,UAAU,CAAC,IAAI,CAAC,QAAQ,CAAC,EAAE,CAAC;gBACnC,SAAS;YACX,CAAC;YACD,MAAM,CAAE,IAAI,CAAC,aAAa,CAAC,GAAG,CAAC,EAAE,KAAK,CAAE,CAAC;QAC3C,CAAC;IACH,CAAC;IAES,QAAQ,CAAC,GAAW;QAC5B,OAAO,IAAA,kBAAO,EAAC,IAAI,CAAC,QAAQ,EAAE,GAAG,CAAC,CAAC;IACrC,CAAC;IAES,aAAa,CAAC,IAAY;QAClC,OAAO,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC;IAC1C,CAAC;CACF;AAzBD,oDAyBC","sourcesContent":["import { ensureTrailingSlash, joinUrl, trimLeadingSlashes } from '../../util/PathUtil';\nimport type { KeyValueStorage } from './KeyValueStorage';\nimport { PassthroughKeyValueStorage } from './PassthroughKeyValueStorage';\n\n/**\n * A {@link KeyValueStorage} that prepends a relative path to the key.\n * Leading slashes of the relative path are trimmed, and a trailing slash is added if needed.\n */\nexport class ContainerPathStorage<T> extends PassthroughKeyValueStorage<T> {\n  protected readonly basePath: string;\n\n  public constructor(source: KeyValueStorage<string, T>, relativePath: string) {\n    super(source);\n    this.basePath = trimLeadingSlashes(ensureTrailingSlash(relativePath));\n  }\n\n  public async* entries(): AsyncIterableIterator<[string, T]> {\n    for await (const [ key, value ] of this.source.entries()) {\n      // The only relevant entries for this storage are those that start with the base path\n      if (!key.startsWith(this.basePath)) {\n        continue;\n      }\n      yield [ this.toOriginalKey(key), value ];\n    }\n  }\n\n  protected toNewKey(key: string): string {\n    return joinUrl(this.basePath, key);\n  }\n\n  protected toOriginalKey(path: string): string {\n    return path.slice(this.basePath.length);\n  }\n}\n"]}