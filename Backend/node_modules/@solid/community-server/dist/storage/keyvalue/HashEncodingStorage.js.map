{"version":3,"file":"HashEncodingStorage.js","sourceRoot":"","sources":["../../../src/storage/keyvalue/HashEncodingStorage.ts"],"names":[],"mappings":";;;AAAA,6CAAyC;AACzC,mDAAqD;AACrD,uFAAoF;AAEpF,6EAA0E;AAE1E;;;;;;;;;GASG;AACH,MAAa,mBAAuB,SAAQ,uDAA6B;IACpD,MAAM,GAAG,IAAA,sBAAY,EAAC,IAAI,CAAC,CAAC;IAE/C,YAAmB,MAAkC;QACnD,KAAK,CAAC,MAAM,CAAC,CAAC;IAChB,CAAC;IAES,QAAQ,CAAC,GAAW;QAC5B,MAAM,IAAI,GAAG,IAAA,wBAAU,EAAC,QAAQ,CAAC,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;QAC5D,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,eAAe,GAAG,OAAO,IAAI,EAAE,CAAC,CAAC;QACnD,OAAO,IAAI,CAAC;IACd,CAAC;IAES,aAAa;QACrB,MAAM,IAAI,iDAAuB,CAAC,qCAAqC,CAAC,CAAC;IAC3E,CAAC;CACF;AAhBD,kDAgBC","sourcesContent":["import { createHash } from 'node:crypto';\nimport { getLoggerFor } from '../../logging/LogUtil';\nimport { NotImplementedHttpError } from '../../util/errors/NotImplementedHttpError';\nimport type { KeyValueStorage } from './KeyValueStorage';\nimport { PassthroughKeyValueStorage } from './PassthroughKeyValueStorage';\n\n/**\n * Encodes the input key with SHA-256 hashing,\n * to make sure there are no invalid or special path characters.\n *\n * This class was created specifically to prevent the issue of identifiers being too long when storing data:\n * https://github.com/CommunitySolidServer/CommunitySolidServer/issues/1013\n *\n * This should eventually be replaced by a more structural approach once internal storage has been refactored\n * and data migration from older versions and formats is supported.\n */\nexport class HashEncodingStorage<T> extends PassthroughKeyValueStorage<T> {\n  protected readonly logger = getLoggerFor(this);\n\n  public constructor(source: KeyValueStorage<string, T>) {\n    super(source);\n  }\n\n  protected toNewKey(key: string): string {\n    const hash = createHash('sha256').update(key).digest('hex');\n    this.logger.debug(`Hashing key ${key} to ${hash}`);\n    return hash;\n  }\n\n  protected toOriginalKey(): string {\n    throw new NotImplementedHttpError('Hash keys cannot be converted back.');\n  }\n}\n"]}