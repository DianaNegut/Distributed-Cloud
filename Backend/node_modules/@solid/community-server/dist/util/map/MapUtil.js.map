{"version":3,"file":"MapUtil.js","sourceRoot":"","sources":["../../../src/util/map/MapUtil.ts"],"names":[],"mappings":";;AAsCA,wBAQC;AAuBD,gCAUC;AA/ED,gDAAuD;AA8BvD;;;;;;GAMG;AACH,8CAA8C;AAC9C,SAAgB,MAAM,CAAkC,GAAM,EAAE,OAAyB;IACvF,KAAK,MAAM,GAAG,IAAI,OAAO,CAAC,MAAM,IAAI,EAAE,EAAE,CAAC;QACvC,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;IAClB,CAAC;IACD,KAAK,MAAM,CAAE,GAAG,EAAE,GAAG,CAAE,IAAI,OAAO,CAAC,GAAG,IAAI,EAAE,EAAE,CAAC;QAC7C,GAAG,CAAC,GAAG,CAAC,GAAG,EAAE,GAAG,CAAC,CAAC;IACpB,CAAC;IACD,OAAO,GAAG,CAAC;AACb,CAAC;AAuBD,SAAgB,UAAU,CAAe,GAAsB,EAAE,GAAS,EAAE,SAAuC;IAEjH,MAAM,KAAK,GAAG,GAAG,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;IAC3B,IAAI,KAAK,EAAE,CAAC;QACV,OAAO,KAAK,CAAC;IACf,CAAC;IACD,OAAO,IAAA,mCAAqB,EAAiB,SAAS,EAAE,EAAE,CAAC,GAAG,EAAU,EAAE;QACxE,GAAG,CAAC,GAAG,CAAC,GAAG,EAAE,GAAG,CAAC,CAAC;QAClB,OAAO,GAAG,CAAC;IACb,CAAC,CAAC,CAAC;AACL,CAAC","sourcesContent":["import { resolvePromiseOrValue } from '../PromiseUtil';\nimport type { PromiseOrValue } from '../PromiseUtil';\nimport type { SetMultiMap } from './SetMultiMap';\n\nexport type ArrayElement<TArray extends readonly unknown[]> = TArray[number];\nexport type EmptyObject = Record<string, never>;\n\nexport type MapKey<T> = T extends Map<infer TKey, unknown> ? TKey : never;\nexport type MapValue<T> = T extends Map<unknown, infer TValue> ? TValue : never;\nexport type MapEntry<T> = T extends Map<unknown, unknown> ? [MapKey<T>, MapValue<T>] : never;\n\n/**\n * A simplified version of {@link MapConstructor} that only allows creating an empty {@link Map}.\n */\nexport type EmptyMapConstructor = new() => Map<unknown, unknown>;\n\n/**\n * Options describing the necessary changes when calling {@link modify}.\n */\nexport type ModifyOptions<T extends SetMultiMap<unknown, unknown>> = {\n  /**\n   * Entries that need to be added to the Map.\n   */\n  add?: Iterable<MapEntry<T>>;\n  /**\n   * Keys that need to be removed from the Map.\n   */\n  remove?: Iterable<MapKey<T>>;\n};\n\n/**\n * Modifies a {@link SetMultiMap} in place by removing and adding the requested entries.\n * Removals happen before additions.\n *\n * @param map - Map to start from.\n * @param options - {@link ModifyOptions} describing the necessary changes.\n */\n// eslint-disable-next-line ts/no-explicit-any\nexport function modify<T extends SetMultiMap<any, any>>(map: T, options: ModifyOptions<T>): T {\n  for (const key of options.remove ?? []) {\n    map.delete(key);\n  }\n  for (const [ key, val ] of options.add ?? []) {\n    map.add(key, val);\n  }\n  return map;\n}\n\n/**\n * Finds the result of calling `map.get(key)`.\n * If there is no result, it instead returns the result of the default function.\n * The Map will also be updated to assign that default value to the given key.\n *\n * @param map - Map to use.\n * @param key - Key to find the value for.\n * @param defaultFn - Function to generate default value to insert and return if no result was found.\n */\nexport function getDefault<TKey, TValue>(map: Map<TKey, TValue>, key: TKey, defaultFn: () => TValue): TValue;\n/**\n * Finds the result of calling `map.get(key)`.\n * If there is no result, it instead returns the result of the default function.\n * The Map will also be updated to assign the resolved default value to the given key.\n *\n * @param map - Map to use.\n * @param key - Key to find the value for.\n * @param defaultFn - Function to generate default value to insert and return if no result was found.\n */\nexport function getDefault<TKey, TValue>(map: Map<TKey, TValue>, key: TKey, defaultFn: () => Promise<TValue>):\nPromise<TValue>;\nexport function getDefault<TKey, TValue>(map: Map<TKey, TValue>, key: TKey, defaultFn: () => PromiseOrValue<TValue>):\nPromiseOrValue<TValue> {\n  const value = map.get(key);\n  if (value) {\n    return value;\n  }\n  return resolvePromiseOrValue<TValue, TValue>(defaultFn(), (val): TValue => {\n    map.set(key, val);\n    return val;\n  });\n}\n"]}