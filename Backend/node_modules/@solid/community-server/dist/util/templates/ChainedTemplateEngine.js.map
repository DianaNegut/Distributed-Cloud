{"version":3,"file":"ChainedTemplateEngine.js","sourceRoot":"","sources":["../../../src/util/templates/ChainedTemplateEngine.ts"],"names":[],"mappings":";;;AACA,qDAAkD;AAGlD;;;;;;;GAOG;AACH,MAAa,qBAA+D,SAAQ,+BAAiB;IAClF,WAAW,CAAoB;IAC/B,cAAc,CAAmB;IACjC,YAAY,CAAS;IAEtC;;;OAGG;IACH,YAAmB,OAAyB,EAAE,YAAY,GAAG,MAAM;QACjE,KAAK,EAAE,CAAC;QACR,IAAI,OAAO,CAAC,MAAM,KAAK,CAAC,EAAE,CAAC;YACzB,MAAM,IAAI,KAAK,CAAC,yCAAyC,CAAC,CAAC;QAC7D,CAAC;QACD,IAAI,CAAC,WAAW,GAAG,OAAO,CAAC,CAAC,CAAC,CAAC;QAC9B,IAAI,CAAC,cAAc,GAAG,OAAO,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;QACvC,IAAI,CAAC,YAAY,GAAG,YAAY,CAAC;IACnC,CAAC;IAEM,KAAK,CAAC,SAAS,CAAC,KAA6B;QAClD,OAAO,IAAI,CAAC,WAAW,CAAC,SAAS,CAAC,KAAK,CAAC,CAAC;IAC3C,CAAC;IAEM,KAAK,CAAC,MAAM,CAAC,EAAE,QAAQ,EAAE,QAAQ,EAA0B;QAChE,IAAI,IAAI,GAAG,MAAM,IAAI,CAAC,WAAW,CAAC,MAAM,CAAC,EAAE,QAAQ,EAAE,QAAQ,EAAE,CAAC,CAAC;QACjE,KAAK,MAAM,MAAM,IAAI,IAAI,CAAC,cAAc,EAAE,CAAC;YACzC,IAAI,GAAG,MAAM,MAAM,CAAC,UAAU,CAAC,EAAE,QAAQ,EAAE,EAAE,GAAG,QAAQ,EAAE,CAAC,IAAI,CAAC,YAAY,CAAC,EAAE,IAAI,EAAE,EAAC,CAAC,CAAC;QAC1F,CAAC;QACD,OAAO,IAAI,CAAC;IACd,CAAC;CACF;AA9BD,sDA8BC","sourcesContent":["import type { TemplateEngineInput } from './TemplateEngine';\nimport { TemplateEngine } from './TemplateEngine';\nimport Dict = NodeJS.Dict;\n\n/**\n * Calls the given array of {@link TemplateEngine}s in the order they appear,\n * feeding the output of one into the input of the next.\n *\n * The first engine will be called with the provided contents and template parameters.\n * All subsequent engines will be called with no template parameter.\n * Contents will still be passed along and another entry will be added for the body of the previous output.\n */\nexport class ChainedTemplateEngine<T extends Dict<unknown> = Dict<unknown>> extends TemplateEngine<T> {\n  private readonly firstEngine: TemplateEngine<T>;\n  private readonly chainedEngines: TemplateEngine[];\n  private readonly renderedName: string;\n\n  /**\n   * @param engines - Engines will be executed in the same order as the array.\n   * @param renderedName - The name of the key used to pass the body of one engine to the next.\n   */\n  public constructor(engines: TemplateEngine[], renderedName = 'body') {\n    super();\n    if (engines.length === 0) {\n      throw new Error('At least 1 engine needs to be provided.');\n    }\n    this.firstEngine = engines[0];\n    this.chainedEngines = engines.slice(1);\n    this.renderedName = renderedName;\n  }\n\n  public async canHandle(input: TemplateEngineInput<T>): Promise<void> {\n    return this.firstEngine.canHandle(input);\n  }\n\n  public async handle({ contents, template }: TemplateEngineInput<T>): Promise<string> {\n    let body = await this.firstEngine.handle({ contents, template });\n    for (const engine of this.chainedEngines) {\n      body = await engine.handleSafe({ contents: { ...contents, [this.renderedName]: body }});\n    }\n    return body;\n  }\n}\n"]}